<p id="notice"><%= notice %></p>

<% if flash[:error] %>
  <div class="alert alert-danger">
    <%= flash[:error] %>
  </div>
<% end %>
<div class="row">
  <div class="col-sm-2 col-xs-2">


    <% if @user.image? %>
        <%= image_tag @user.image_url, :class=>'profile-image'%>
      <% else %>
          <%= image_tag "user.png"%>
    <% end %>
  </div>
  <div class="col-sm-4 col-xs-4">
    <span class='user-name'><%= @user.first_name + " " + @user.last_name %></span> <br />
    <%= @user.location %> <br />
    <% if @user == User.find(session[:user_id]) %>
      <%= link_to 'Go to Your Fridge', new_fridge_ingredient_path %>
    <% else %>
      <p>Ask to share users fridge</p>
    <% end %>
    <div class="metadata-text">
      Number of Recipes: <%= @user.recipes.count %> <br>

      <% allRecipeSum = 0 %>
      <% numOfFeedbacks = 0 %>
      <% @user.recipes.each  do |recipe| %>
      <% recipeSum = 0 %>
      <% recipe.feedbacks.each do |feedback| %>
      <% recipeSum += feedback.rating %>
      <% numOfFeedbacks += 1 %>
      <%end%>
      <% allRecipeSum += recipeSum %>
      <%end%>
      Average Feedback Rating: <%= number_with_precision(allRecipeSum.to_f / numOfFeedbacks, :precision => 2) %>
    </div>
  </div>
    <span class='user-name'><%= "My Recipes" %></span> <br />
    <% if @user.recipes.empty? %>
      <table class="sortable">
        <tr>
          <th>Name</th>

          <th>Ratings</th>
          <th></th>
          <th></th>
        </tr>
      <table/>
    <% else %>
        <table class="sortable">
        <tr>
          <th>Name</th>

          <th>Ratings</th>
          <th></th>
          <th></th>
        </tr>
      <% @user.recipes.each do |o| %>
              <tr>
      <% feedbackSum = 0.0 %>
      <% feedbackCount = 0.0 %>
      <% o.feedbacks.each do |i| %>
      <% feedbackSum += i.rating %>
      <% feedbackCount += 1.0 %>
      <% end %>

                <% if o.drinktype == "jjuice"%>

                    <td><%= image_tag 'redcup.png' %>
                <% elsif o.drinktype == "martini"%>
                    <td><%= image_tag 'glass.png' %>
                <% else%>
                    <td><%= image_tag 'cocktail.png' %>
                <%end%><%= link_to o.name, o %><td/>

      <td><% if o.feedbacks.empty? %>No Ratings.<% else %>
      <%=number_with_precision(feedbackSum/feedbackCount, :precision => 2)%>
      <% end %><td/>
      <% end %>
          <tr/>
            <table/>
      <% end %>

</div>


