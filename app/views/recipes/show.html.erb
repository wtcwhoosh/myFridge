<p id="notice"><%= notice %></p>

<p>
  <b>Name:</b>
  <%= @recipe.name %>
</p>
<p>
  <b>By:</b>
  <%= link_to @recipe.user.name, @recipe.user %>
</p>
<p>
  <b>Ingredients:</b><br>
  <% if @recipe.ingredients.empty? %>
      No ingredients for the question have been defined.
  <% else %>
  <% end %>
</p>
<% showRecipeIngredients = [] %>
<% if @recipe.recipe_ingredients %>
    <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
        <ul>
          <li><%=recipe_ingredient.ingredient.name %></li>
          <% showRecipeIngredients.push(recipe_ingredient.ingredient.name.downcase)%>
        </ul>
    <% end %>
<% end %>
<p>
  <b>Instructions:</b>
  <%= @recipe.instruction %>
</p>
<p>
  <% if @recipe.feedbacks.empty? %>
      No Reviews
  <% else %>
      <% @recipe.feedbacks.each do |o| %>
          <b>Feedback: </b> Rating: <%= o.rating %> | <%= o.comment %> <br />
      <% end %>
  <% end %>
</p>


<% similarRecipes = [] %>
You might want to check out <br>
<% @recipes = Recipe.find(:all) %>

<% @recipes.each do |recipe| %>
   <%if recipe.name != @recipe.name %>
        <% recipeIngredients = [] %>
        <% isIncluded = false %>
        <% recipe.recipe_ingredients.each do |recipe_ingredient| %>
            <% recipeIngredients.push(recipe_ingredient.ingredient_id) %>
        <% end %>

        <% recipeIngredientArray = [] %>
        <% @ingredients = Ingredient.find(:all)  %>
        <% Ingredient.all.each do |ingredient|%>
            <% if recipeIngredients.include? ingredient.id%>
                <% recipeIngredientArray.push(ingredient.name.downcase) %>
            <%end%>
        <%end%>




        <% require 'set' %>
        <% set_checkRecipeIngredients = recipeIngredientArray.to_set %>
        <% set_showRecipeIngredients = showRecipeIngredients.to_set %>
        <% a2bisIncluded = false %>
        <% recipeIngredientArray.each do |ria| %>
           <%tempArray = [ria] %>
           <% if tempArray.to_set.subset? set_showRecipeIngredients %>
                <% a2bisIncluded = true %>
                <% break %>
           <% end %>
        <% end %>
        <% b2aisIncluded = false %>
        <% showRecipeIngredients.each do |ria| %>
            <%tempArray = [ria] %>
            <% if tempArray.to_set.subset? set_checkRecipeIngredients %>
                <% b2aisIncluded = true %>
                <% break %>
            <% end %>
        <% end %>

        <% if a2bisIncluded || b2aisIncluded %>
           <% similarRecipes.push(recipe) %>
        <% end %>
    <%end%>
<%end%>

<% similarRecipesMap = Hash.new %>
<% similarRecipes.each do |recipe| %>
    <% feedbackSum = 0.0 %>
    <% feedbackCount = 0.0 %>
    <% recipe.feedbacks.each do |i| %>
        <% feedbackSum += i.rating %>
        <% feedbackCount += 1.0 %>
    <% end %>

    <% if recipe.feedbacks.empty? %>
       <% similarRecipesMap[recipe] = "No Ratings" %>
    <% else %>
       <% similarRecipesMap[recipe] = (number_with_precision(feedbackSum/feedbackCount, :precision => 2)).to_s%>
    <% end %>

<% end %>
<% similarRecipesMap = Hash[similarRecipesMap.sort_by {|k,v| v}.reverse] %>
<% loopStopCount = 0 %>
<% leftOver = Hash.new %>
<% similarRecipesMap.each do |recipe, rating| %>
    <% if !rating.eql? "No Ratings" %>
    <%= link_to recipe.name, recipe %> | <%= rating %> <br>
    <% loopStopCount += 1 %>
    <% if loopStopCount == 10 %>
        <% break %>
    <% end %>
    <% else %>
    <%leftOver[recipe] = rating %>
    <% end %>
    <% end %>
<%if loopStopCount != 10 %>
    <% leftOver.each do |recipe, rating| %>
        <%= link_to recipe.name, recipe %> | <%= rating %> <br>
        <% loopStopCount += 1 %>
        <% if loopStopCount == 10 %>
            <% break %>
        <% end %>
    <% end %>
<% end %>


<%= link_to 'Add Reviews', :controller => 'feedbacks', :action => 'new',
            :recipe_id => @recipe.id %>
<%= link_to 'Edit', edit_recipe_path(@recipe) %> |
<%= link_to 'Back', recipes_path %>